# caffe安装遇到的问题

我的环境 cuda 10.2，cudnn7.6.5，opencv3.2.0

这里的问题有些是 yolov5 转换遇到的问题，有些是 yolov3 转换遇到的问题

基本步骤参考该文章：https://github.com/Wulingtian/yolov5_caffe

## compute

```
# CUDA_ARCH := -gencode arch=compute_20,code=sm_20 \
#               -gencode arch=compute_20,code=sm_21
CUDA_ARCH :=    -gencode arch=compute_30,code=sm_30 \
                -gencode arch=compute_35,code=sm_35 \
                -gencode arch=compute_50,code=sm_50 \
                -gencode arch=compute_52,code=sm_52 \
                -gencode arch=compute_60,code=sm_60 \
                -gencode arch=compute_61,code=sm_61 \
                -gencode arch=compute_61,code=compute_61
```

解决方法：不支持哪个，就注释哪个

## numpy

查找你电脑上对应文件的位置，添加到下面路径即可

```
PYTHON_INCLUDE := /usr/include/python3.6m \
/home/yourname/.local/lib/python3.6/site-packages/numpy/core/include\
```

## AttributeError: permute_param 或者 AttributeError: Upsample_param

参考：https://blog.csdn.net/ynzzxc/article/details/116931806

## OverflowError: cannot fit 'int' into an index-sized integer

```
make clean
make all
make pycaffe
```

## conv

可以更改 --opset 版本试试

## KeyError（395什么的）

模型转换时加上 --train

## 编译caffe时：caffe.pb.h:17:2: error: #error This file was generated by an older version of protoc，

改成你自己的路径即可

```makefile
ANACONDA_HOME := $(HOME)/anaconda3/envs/yolo
PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
                $(ANACONDA_HOME)/include/python3.6m \
                $(ANACONDA_HOME)/lib/python3.6/site-packages/numpy/core/include
```
还有另一种情况会报错 proto/ 路径下没有 caffe.pb.h 的问题，查找一下自己路径下该文件的位置，然后 mv 到报错
路径下即可

## CV_LOAD_IMAGE_COLOR和CV_BGR2HSV和CV_CAP_PROP_FRAME_WIDTH

参考：https://blog.csdn.net/weixin_44675820/article/details/124796674

## ONNX export failure/Couldn't build proto file into descriptor pool

```
pip install protobuf=3.20.3
```

## error: identifier "PoolingParameter_RoundMode" is undefined/"caffe::LayerParameter" has no member "clip_param"

将之前编译成功的文件中，包含这部分的内容进行拷贝即可

## error: ‘class caffe::SolverParameter’ has no member named ‘clear_weights’

```c++
optional bool layer_wise_reduce = 45 [default = true];
repeated string weights = 46;
```

## No rule to make target '/usr/lib/x86_64-linux-gnu/libGLEW.so.1.13', needed by 'x86_64/lib/libyolov3-plugin.so'

查看：https://www.cnblogs.com/yongfengnice/p/8568557.html，下载后更改为自己的版本即可

```
target_link_libraries(yolov3-plugin
        /home/name/caffe/build/lib/libcaffe.so
        /usr/lib/x86_64-linux-gnu/libglog.so
        /usr/lib/x86_64-linux-gnu/libgflags.so.2
        /usr/lib/x86_64-linux-gnu/libboost_system.so
        /usr/lib/x86_64-linux-gnu/libGLEW.so.2.0
)
```

